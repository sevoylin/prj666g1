{"version":3,"sources":["../../src/pages/create-event/create-event.module.ts","../../src/pages/create-event/create-event.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AAAyC;AACO;AACC;AAUjD;IAAA;IAAoC,CAAC;IAAxB,qBAAqB;QARjC,uEAAQ,CAAC;YACR,YAAY,EAAE;gBACZ,sEAAe;aAChB;YACD,OAAO,EAAE;gBACP,sEAAe,CAAC,QAAQ,CAAC,sEAAe,CAAC;aAC1C;SACF,CAAC;OACW,qBAAqB,CAAG;IAAD,4BAAC;CAAA;AAAH;;;;;;;;;;;;;;;;;;;;;;;;;ACZ+B;AACE;AACf;AACI;AAInB;AASrC;IAaE,yBAAmB,OAAsB,EACtB,SAAoB,EACpB,MAAuB,EACvB,QAAiB,EAChB,WAAuB;QAJ3C,iBAWC;QAXkB,YAAO,GAAP,OAAO,CAAe;QACtB,cAAS,GAAT,SAAS,CAAW;QACpB,WAAM,GAAN,MAAM,CAAiB;QACvB,aAAQ,GAAR,QAAQ,CAAS;QAChB,gBAAW,GAAX,WAAW,CAAY;QAhB3C,SAAI,GAAG,EAAU,CAAC;QAClB,UAAK,GAAG,EAAW,CAAC;QAEpB,WAAM,GAAG,EAAY,CAAC;QACtB,WAAM,GAAG,EAAY,CAAC;QAItB,SAAS;QACT,cAAS,GAAG,KAAgB,CAAC;QAC7B,gBAAW,GAAG,KAAgB,CAAC;QAO7B,IAAI,CAAC,IAAI,CAAC,GAAG,GAAG,MAAM,CAAC,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC;QAC5C,IAAI,CAAC,KAAK,CAAC,SAAS,GAAG,KAAK,CAAC;QAC7B,IAAI,CAAC,KAAK,CAAC,IAAI,GAAG,IAAI,IAAI,EAAE,CAAC;QAC7B,QAAQ,CAAC,KAAK,EAAE,CAAC,IAAI,CAAC;YACpB,KAAI,CAAC,OAAO,EAAE,CAAC;QACjB,CAAC,CAAC,CAAC;IACL,CAAC;IAED,iCAAO,GAAP;QAAA,iBAsCC;QApCC,IAAI,QAAQ,GAAG,mDAAkB,EAAE,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC,GAAG,EAAE,CAAC;QAC9D,IAAI,OAAO,GAAG,mDAAkB,EAAE,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QAC1E,IAAI,OAAO,GAAG,mDAAkB,EAAE,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC,GAAG,EAAE,CAAC;QAE5D,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,KAAK,CAAC,MAAM,IAAE,SAAS,CAAC;YAClD,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC;QACxB,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC;YACpB,IAAI,CAAC,KAAK,CAAC,QAAQ,GAAG,EAAE,CAAC;QAE3B,EAAE,CAAC,CAAC,IAAI,CAAC,aAAa,EAAE,CAAC,EAAC;YACxB,4BAA4B;YAC5B,OAAO,CAAC,GAAG,CAAC;gBACV,IAAI,EAAE,IAAI,CAAC,KAAK,CAAC,SAAS;gBAC1B,QAAQ,EAAE,EAAE;aACb,CAAC,CAAC;YACH,IAAI,CAAC,KAAK,CAAC,IAAI,GAAG,OAAO,CAAC;YAE1B,6BAA6B;YAC7B,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YAEzB,6BAA6B;YAC7B,IAAI,KAAK,GAAG,KAAK,CAAC;YAClB,OAAO,CAAC,UAAU,CAAC,UAAC,GAAG;gBACrB,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,EAAC;oBACV,KAAI,CAAC,IAAI,CAAC,SAAS,GAAG,GAAG,CAAC,IAAI,EAAE,CAAC,SAAS,CAAC;oBAC3C,KAAI,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;oBACnC,OAAO,CAAC,MAAM,CAAC,WAAW,EAAC,KAAI,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;oBAChD,KAAK,GAAG,IAAI,CAAC;gBACf,CAAC;YACH,CAAC,CAAC,CAAC;YACH,OAAO,CAAC,UAAU,CAAC,cAAK,CAAC,CAAC,CAAC;YAC3B,IAAI,CAAC,OAAO,CAAC,GAAG,EAAE,CAAC;QACrB,CAAC;QACD,IAAI,EAAC;YACH,mBAAmB;QACrB,CAAC;IACH,CAAC;IAED,uCAAa,GAAb;QACE,IAAI,OAAO,GAAG,IAAI,CAAC;QACnB,aAAa;QACb,EAAE,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,SAAS,IAAE,SAAS,IAAI,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,IAAI,EAAE,IAAI,EAAE,CAAC;YACvE,OAAO,GAAG,KAAK,CAAC;QAClB,eAAe;QACf,EAAE,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,GAAE,CAAE,CAAC;YACxB,OAAO,GAAG,KAAK,CAAC;QAClB,UAAU;QACV,EAAE,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC;YACZ,IAAI,KAAK,GAAG,mDAAkB,EAAE,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YACxE,IAAI,CAAC,KAAK,CAAC,OAAO,GAAG,KAAK,CAAC;YAC3B,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,KAAK,CAAC,CAAC;YAC5B,IAAI,CAAC,KAAK,CAAC,YAAY,GAAG,CAAC,KAAK,CAAC,CAAC;YAClC,IAAI,CAAC,KAAK,CAAC,YAAY,GAAG,EAAE,CAAC;YAC7B,IAAI,CAAC,KAAK,CAAC,SAAS,GAAG,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,IAAI,EAAE,CAAC;YACnD,IAAI,CAAC,KAAK,CAAC,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAC;YACjD,IAAI,CAAC,KAAK,CAAC,WAAW,GAAG,IAAI,IAAI,EAAE,CAAC;YAEpC;;;;;;;cAOE;YACF,IAAI,GAAG,GAAG,IAAI,CAAC,MAAM,CAAC,WAAW,EAAE,CAAC,QAAQ,EAAE,CAAC;YAC/C,IAAI,GAAG,GAAG,MAAM,CAAC,UAAU,CAAC,GAAG,CAAC,SAAS,CAAC,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,GAAC,CAAC,EAAC,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;YAChF,IAAI,GAAG,GAAG,MAAM,CAAC,UAAU,CAAC,GAAG,CAAC,SAAS,CAAC,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,GAAC,CAAC,EAAC,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;YAChF,IAAI,CAAC,KAAK,CAAC,QAAQ,GAAG,IAAI,mDAAkB,CAAC,QAAQ,CAAC,GAAG,EAAC,GAAG,CAAC,CAAC;QACjE,CAAC;QAED,MAAM,CAAC,OAAO,CAAC;IACjB,CAAC;IAED,iCAAO,GAAP;QAAA,iBA4BC;QA3BC,IAAI,CAAC,WAAW,CAAC,kBAAkB,CAAC,EAAE,UAAU,EAAE,IAAI,EAAE,OAAO,EAAE,IAAI,EAAE,kBAAkB,EAAE,IAAI,EAAE,CAAC;aAC/F,IAAI,CAAC,UAAC,IAAI;YACT,IAAI,UAAU,GAAG,IAAI,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAC,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;YACpF,KAAI,CAAC,GAAG,GAAG,IAAI,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,KAAI,CAAC,UAAU,CAAC,aAAa,EAAE;gBAC5D,IAAI,EAAE,EAAE;gBACR,MAAM,EAAE,UAAU;aACnB,CAAC,CAAC;YAEH,KAAI,CAAC,MAAM,GAAG,IAAI,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC;gBACnC,QAAQ,EAAE,UAAU;gBACpB,GAAG,EAAE,KAAI,CAAC,GAAG;gBACb,SAAS,EAAE,MAAM;gBACjB,SAAS,EAAE,IAAI;aAChB,CAAC,CAAC;YAEH,KAAI,CAAC,MAAM,GAAG,IAAI,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC;gBACnC,WAAW,EAAE,SAAS;gBACtB,aAAa,EAAE,GAAG;gBAClB,YAAY,EAAE,CAAC;gBACf,SAAS,EAAE,SAAS;gBACpB,WAAW,EAAE,IAAI;gBACjB,GAAG,EAAE,KAAI,CAAC,GAAG;gBACb,MAAM,EAAE,UAAU;gBAClB,MAAM,EAAE,CAAC;aACV,CAAC,CAAC;YACH,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,KAAI,CAAC,MAAM,EAAE,SAAS,EAAC,cAAK,KAAI,CAAC,SAAS,EAAE,GAAC,CAAC,CAAC;QACjF,CAAC,CAAC,CAAC;IACL,CAAC;IAED,mCAAS,GAAT;QACE,EAAE,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,EAAC;YAClB,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,WAAW,EAAE,CAAC,CAAC;YACjD,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG,EAAE,CAAC,CAAC,CAAC;QACjE,CAAC;QACD,IAAI,EAAC;YACH,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,WAAW,EAAE,CAAC,CAAC;YACjD,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;QAC3B,CAAC;IACH,CAAC;IAED,wCAAc,GAAd;QACE,OAAO,CAAC,GAAG,CAAC,gCAAgC,CAAC,CAAC;IAChD,CAAC;IA1IiB;QAAjB,yEAAS,CAAC,KAAK,CAAC;kCAAY,iEAAU;uDAAC;IAP7B,eAAe;QAJ3B,wEAAS,CAAC;YACT,QAAQ,EAAE,mBAAmB;WACG;SACjC,CAAC;6EAcyC;YACX,0EAAS;YACZ,gEAAe;YACd,8EAAQ;YACJ,WAAW;OAjBhC,eAAe,CAmJ3B;IAAD,CAAC;AAAA;SAnJY,eAAe,gB","file":"15.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { CreateEventPage } from './create-event';\n\n@NgModule({\n  declarations: [\n    CreateEventPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(CreateEventPage),\n  ],\n})\nexport class CreateEventPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/create-event/create-event.module.ts","import { Component, ElementRef, ViewChild } from '@angular/core';\nimport { IonicPage, NavController, NavParams, Platform } from 'ionic-angular';\nimport { AngularFireAuth } from 'angularfire2/auth';\nimport { Geolocation } from '@ionic-native/geolocation';\nimport { GoogleMaps, GoogleMap, GoogleMapsEvent, CameraPosition, GoogleMapOptions, Circle, Marker, MarkerOptions, LatLng} from '@ionic-native/google-maps';\nimport { User } from '../../models/user';\nimport { Event } from '../../models/event';\nimport * as firebase from 'firebase';\n\ndeclare var google: any;\n\n@IonicPage()\n@Component({\n  selector: 'page-create-event',\n  templateUrl: 'create-event.html',\n})\nexport class CreateEventPage {\n  user = {} as User;\n  event = {} as Event;\n  map: GoogleMap;\n  marker = {} as Marker;\n  circle = {} as Circle;\n \n  @ViewChild('map') mapElement:ElementRef;\n\n  // Toggle\n  hasRadius = false as boolean;\n  hasPassword = false as boolean;\n  \n  constructor(public navCtrl: NavController,\n              public navParams: NavParams,\n              public afAuth: AngularFireAuth,\n              public platform:Platform,\n              private geolocation:Geolocation) {\n    this.user.uid = afAuth.auth.currentUser.uid;\n    this.event.isPrivate = false;\n    this.event.date = new Date();\n    platform.ready().then(() => {\n      this.initMap();\n    });\n  }\n  \n  saveBtn() {\n\n    var eventDoc = firebase.firestore().collection('Event').doc();\n    var userDoc = firebase.firestore().collection('Users').doc(this.user.uid);\n    var chatDoc = firebase.firestore().collection('Chat').doc();\n    \n    if (!this.hasRadius || this.event.radius==undefined)\n      this.event.radius = 0;\n    if (!this.hasPassword)\n      this.event.password = \"\";\n\n    if (this.validateValue()){\n      // save in \"chat\" collection\n      chatDoc.set({\n        name: this.event.eventName,\n        messages: []\n      });\n      this.event.chat = chatDoc;\n\n      // save in \"event\" collection\n      eventDoc.set(this.event);\n\n      // save in \"users\" collection\n      var saved = false;\n      userDoc.onSnapshot((doc)=>{\n        if (!saved){\n          this.user.eventList = doc.data().eventList;\n          this.user.eventList.push(eventDoc);\n          userDoc.update(\"eventList\",this.user.eventList);\n          saved = true;\n        }\n      });\n      userDoc.onSnapshot(()=>{});\n      this.navCtrl.pop();\n    }\n    else{\n      // * handle pop msg\n    }\n  }\n\n  validateValue() {\n    var isValid = true;\n    // Check Name\n    if (this.event.eventName==undefined || this.event.eventName.trim() == \"\")\n      isValid = false;\n    // Check Radius\n    if (this.event.radius <0 )\n      isValid = false;\n    // Pre-fix\n    if (isValid) {\n      var owner = firebase.firestore().collection('Users').doc(this.user.uid);\n      this.event.creator = owner;\n      this.event.admins = [owner];\n      this.event.participants = [owner];\n      this.event.blockedUsers = [];\n      this.event.eventName = this.event.eventName.trim();\n      this.event.password = this.event.password.trim();\n      this.event.dateCreated = new Date();\n\n      /* Trick things here:\n        marker.getPostion().lat and marker.getPostion().lng supposed to be 2 number\n        in this plugin it turned to 2 getter function\n        it act like function when I add 2 bracket after them\n        it won't compile because cordova treat it as an error\n        it will work after `ionic serve`\n        so I decided transfer position to string and re-form it to number\n      */\n      let loc = this.marker.getPosition().toString();\n      let lat = Number.parseFloat(loc.substring(loc.indexOf('(')+1,loc.indexOf(',')));\n      let lng = Number.parseFloat(loc.substring(loc.indexOf(' ')+1,loc.indexOf(')')));\n      this.event.location = new firebase.firestore.GeoPoint(lat,lng);\n    }\n\n    return isValid;\n  }\n\n  initMap() {\n    this.geolocation.getCurrentPosition({ maximumAge: 3000, timeout: 5000, enableHighAccuracy: true })\n      .then((resp) => {\n        let mylocation = new google.maps.LatLng(resp.coords.latitude,resp.coords.longitude);\n        this.map = new google.maps.Map(this.mapElement.nativeElement, {\n          zoom: 15,\n          center: mylocation\n        });\n        \n        this.marker = new google.maps.Marker({\n          position: mylocation,\n          map: this.map,\n          animation: 'Drop',\n          draggable: true\n        });\n\n        this.circle = new google.maps.Circle({\n          strokeColor: '#21E7B6',\n          strokeOpacity: 0.8,\n          strokeWeight: 1,\n          fillColor: '#21E7B6',\n          fillOpacity: 0.35,\n          map: this.map,\n          center: mylocation,\n          radius: 0\n        });\n        google.maps.event.addListener(this.marker, 'dragend',()=>{this.setCircle()});\n    });\n  }\n\n  setCircle(){\n    if (this.hasRadius){\n      this.circle.setCenter(this.marker.getPosition());\n      this.circle.setRadius(Number.parseInt(this.event.radius + \"\"));\n    }\n    else{\n      this.circle.setCenter(this.marker.getPosition());\n      this.circle.setRadius(0);\n    }\n  }\n  \n  ionViewDidLoad() {\n    console.log('ionViewDidLoad CreateEventPage');\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/create-event/create-event.ts"],"sourceRoot":""}